generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}
enum Intent {
  INFORMATIONAL
  COMMERCIAL
  TRANSACTIONAL
  COMPARISON
}

model Admin {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  createdAt DateTime @default(now())
}
enum ContentStatus {
  PUBLISHED
  DRAFT
  PRIVATE
}

model Topic {
  id       Int     @id @default(autoincrement())
  name     String
  slug     String  @unique
  status   ContentStatus @default(PUBLISHED)
  seoTitle String?
  seoDesc  String?
  posts    Post[]

  parentId Int?
  parent   Topic?  @relation("TopicHierarchy", fields: [parentId], references: [id])
  children Topic[] @relation("TopicHierarchy")
}
model Post {
  id          Int       @id @default(autoincrement())
  title       String
  slug        String    @unique
  excerpt     String?
  content     String
  status      ContentStatus @default(PUBLISHED)
  intent      Intent
  topicId     Int
  topic       Topic     @relation(fields: [topicId], references: [id])
  tags        PostTag[]
  affiliates  PostAffiliate[]
  schemaMarkup String?  // custom JSON-LD
  thumbnail   String?
  publishedAt DateTime?
  createdAt   DateTime  @default(now())
}

model PostTag {
  postId Int
  tagId  Int

  post Post @relation(fields: [postId], references: [id])
  tag  Tag  @relation(fields: [tagId], references: [id])

  @@id([postId, tagId])
}

model Tag {
  id    Int     @id @default(autoincrement())
  name  String
  slug  String  @unique
  type  TagType
  posts PostTag[]
}
enum TagType {
  PRODUCT
  BRAND
  STYLE
  PROBLEM
  PRICE
}
model Affiliate {
  id    Int     @id @default(autoincrement())
  name  String
  brand String?
  price String?
  image String?
  url   String
  status ContentStatus @default(PUBLISHED)
  
  brandId Int?
  brandRelation Brand? @relation(fields: [brandId], references: [id])
  
  posts PostAffiliate[]
}

model Brand {
  id          Int         @id @default(autoincrement())
  name        String
  slug        String      @unique
  description String?
  logo        String?
  status      ContentStatus @default(PUBLISHED)
  affiliates  Affiliate[]
}

model PostAffiliate {
  postId      Int
  affiliateId Int

  post       Post       @relation(fields: [postId], references: [id])
  affiliate  Affiliate  @relation(fields: [affiliateId], references: [id])

  @@id([postId, affiliateId])
}
model ClickLog {
  id          Int      @id @default(autoincrement())
  affiliateId Int
  url         String   // Link gốc lúc click
  postId      Int?     // User click từ bài nào (nếu track được)
  ip          String?  // Tracker cơ bản
  userAgent   String?  // Tracker thiết bị (Mobile/PC)
  clickedAt   DateTime @default(now())
  @@index([affiliateId])
  @@index([clickedAt])
}